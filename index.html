<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=360, height=640, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bird-Dash</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            background: linear-gradient(180deg, #7fd2ff 0%, #87ddff 40%, #b9f2ff 100%);
            width: 360px;
            height: 640px;
            margin: 0 auto;
            position: relative;
        }

        #game-container {
            position: relative;
            width: 360px;
            height: 640px;
            overflow: hidden;
        }

        #game-canvas {
            display: block;
            width: 360px;
            height: 640px;
            background: linear-gradient(180deg, #8ed9ff 0%, #a6e4ff 45%, #d7f6ff 100%);
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 360px;
            height: 640px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(14, 23, 49, 0.65);
            backdrop-filter: blur(6px);
            color: white;
            text-align: center;
        }

        .screen.hidden {
            display: none;
        }

        .screen h1, .screen h2 {
            font-weight: 800;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }

        .difficulty-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        button {
            padding: 12px 24px;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            background: #0f1734;
            border: 1px solid #22306e;
            color: #eaf1ff;
            cursor: pointer;
            transition: all 0.3s;
            width: 200px;
        }

        button:hover {
            border-color: #2e43a6;
            transform: translateY(-2px);
        }

        #game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
        }

        #final-score, #best-score {
            font-weight: 700;
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }

        .hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #0c2257;
            font-size: 14px;
        }

        #menu-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 16px;
            font-size: 1rem;
            z-index: 100;
            display: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="360" height="640"></canvas>
        <button id="menu-btn">Menu</button>
        <div id="menu" class="screen">
            <h1>üê§ Bird-Dash</h1>
            <div class="difficulty-buttons">
                <button data-difficulty="easy">Facile</button>
                <button data-difficulty="normal">Normal</button>
                <button data-difficulty="hard">Difficile</button>
                <button data-difficulty="expert">Expert</button>
            </div>
        </div>
        <div id="instructions" class="screen hidden">
            <h2>Clique/Espace pour voler</h2>
            <p>Passe entre les tuyaux !</p>
        </div>
        <div id="game-over" class="screen hidden">
            <h2>Game Over</h2>
            <p>Score: <span id="final-score">0</span></p>
            <p>Meilleur: <span id="best-score">0</span></p>
            <button id="restart-btn">Rejouer</button>
            <button id="back-to-menu-btn">Menu</button>
        </div>
        <div class="hint">Espace / Clic / Touch = voler</div>
    </div>

    <!-- Sons -->
    <audio id="jump-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-quick-jump-arcade-game-239.mp3" preload="auto"></audio>
    <audio id="score-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>
    <audio id="hit-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-game-over-213.mp3" preload="auto"></audio>

    <script>
        // Configuration du jeu
        const config = {
            difficulties: {
                easy: { speed: 2, gap: 140, pipeInterval: 1500, gravity: 0.2, jumpForce: -4.5 },
                normal: { speed: 2.5, gap: 120, pipeInterval: 1200, gravity: 0.25, jumpForce: -4.8 },
                hard: { speed: 3, gap: 100, pipeInterval: 1000, gravity: 0.3, jumpForce: -5.0 },
                expert: { speed: 3.5, gap: 80, pipeInterval: 800, gravity: 0.35, jumpForce: -5.2 }
            }
        };

        // √âl√©ments du DOM
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const menuScreen = document.getElementById('menu');
        const instructionsScreen = document.getElementById('instructions');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreElement = document.getElementById('final-score');
        const bestScoreElement = document.getElementById('best-score');
        const restartBtn = document.getElementById('restart-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const menuBtn = document.getElementById('menu-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-buttons button');

        // Sons
        const jumpSound = document.getElementById('jump-sound');
        const scoreSound = document.getElementById('score-sound');
        const hitSound = document.getElementById('hit-sound');

        // Variables du jeu
        let gameRunning = false;
        let score = 0;
        let bestScore = localStorage.getItem('birdDashBestScore') || 0;
        let difficulty = config.difficulties.normal;
        let animationFrameId;
        let pipeIntervalId;
        let lastTime = 0;
        let accumulator = 0;
        let isClicking = false;

        // Objet Oiseau
        const bird = {
            x: 100,
            y: 320,
            radius: 12,
            velocity: 0,
            rotation: 0,
            color: '#FFD700',
            
            update: function() {
                this.velocity += difficulty.gravity;
                this.y += this.velocity;
                this.rotation = Math.min(Math.max(this.velocity * 0.1, -0.5), 0.5);
                
                // Emp√™cher l'oiseau de sortir par le haut
                if (this.y - this.radius < 0) {
                    this.y = this.radius;
                    this.velocity = 0;
                }
            },
            
            draw: function() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                // Corps de l'oiseau avec d√©grad√©
                const gradient = ctx.createRadialGradient(-4, -6, 6, 0, 0, 18);
                gradient.addColorStop(0, '#ffe985');
                gradient.addColorStop(0.7, '#ffcc45');
                gradient.addColorStop(1, '#ffb020');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.ellipse(0, 0, this.radius * 1.1, this.radius * 0.95, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Ailes avec animation
                const wingY = Math.sin(Date.now() * 0.01) * 2;
                ctx.fillStyle = '#fff6cf';
                ctx.beginPath();
                ctx.ellipse(-2, wingY, this.radius * 0.7, this.radius * 0.45, -0.5, 0, Math.PI * 2);
                ctx.fill();
                
                // ≈íil
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(5, -4, this.radius * 0.28, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(7, -3, this.radius * 0.12, 0, Math.PI * 2);
                ctx.fill();
                
                // Bec
                ctx.fillStyle = '#ff7b18';
                ctx.beginPath();
                ctx.moveTo(this.radius * 0.9, 0);
                ctx.lineTo(this.radius * 1.5, 4);
                ctx.lineTo(this.radius * 0.9, 6);
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
            },
            
            jump: function() {
                this.velocity = difficulty.jumpForce;
                try {
                    jumpSound.currentTime = 0;
                    jumpSound.play();
                } catch(e) {
                    console.log("Erreur de son:", e);
                }
            },
            
            reset: function() {
                this.y = 320;
                this.velocity = 0;
                this.rotation = 0;
            }
        };

        // Tuyaux (obstacles)
        const pipes = {
            list: [],
            width: 64,
            color: '#43d96b',
            edgeColor: '#31c45a',
            
            add: function() {
                const gapHeight = difficulty.gap;
                const minHeight = 40;
                const maxHeight = 640 - ground.height - gapHeight - minHeight;
                const topHeight = minHeight + Math.random() * maxHeight;
                
                this.list.push({
                    x: 360,
                    topHeight: topHeight,
                    bottomY: topHeight + gapHeight,
                    passed: false
                });
            },
            
            update: function() {
                for (let i = 0; i < this.list.length; i++) {
                    const pipe = this.list[i];
                    pipe.x -= difficulty.speed;
                    
                    // Supprimer les tuyaux hors de l'√©cran
                    if (pipe.x + this.width < 0) {
                        this.list.splice(i, 1);
                        i--;
                    }
                }
            },
            
            draw: function() {
                for (const pipe of this.list) {
                    const lip = 10;
                    
                    // Tuyau du haut
                    ctx.fillStyle = this.color;
                    ctx.fillRect(pipe.x, 0, this.width, pipe.topHeight);
                    
                    // Bordure du tuyau du haut
                    ctx.fillStyle = this.edgeColor;
                    ctx.fillRect(pipe.x - 2, pipe.topHeight - lip, this.width + 4, lip);
                    
                    // Tuyau du bas
                    ctx.fillStyle = this.color;
                    ctx.fillRect(pipe.x, pipe.bottomY, this.width, 640 - pipe.bottomY - ground.height);
                    
                    // Bordure du tuyau du bas
                    ctx.fillStyle = this.edgeColor;
                    ctx.fillRect(pipe.x - 2, pipe.bottomY, this.width + 4, lip);
                    
                    // Effet de lumi√®re sur les tuyaux
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.25)';
                    if (pipe.topHeight > 40) {
                        ctx.fillRect(pipe.x + 6, 6, 6, pipe.topHeight - 12);
                    }
                    const bottomHeight = 640 - pipe.bottomY - ground.height;
                    if (bottomHeight > 12) {
                        ctx.fillRect(pipe.x + 6, pipe.bottomY + 6, 6, bottomHeight - 12);
                    }
                }
            },
            
            reset: function() {
                this.list = [];
            }
        };

        // Sol
        const ground = {
            height: 100,
            color: '#caa46a',
            grassColor: '#7be66a',
            edgeColor: '#3ab54a',
            x: 0,
            
            update: function() {
                this.x -= difficulty.speed;
                if (this.x <= -48) {
                    this.x = 0;
                }
            },
            
            draw: function() {
                const y = 640 - this.height;
                
                // Partie herbe
                const gradient = ctx.createLinearGradient(0, y - 12, 0, y + 8);
                gradient.addColorStop(0, this.grassColor);
                gradient.addColorStop(1, this.edgeColor);
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, y, 360, 18);
                
                // Partie terre
                ctx.save();
                ctx.beginPath();
                ctx.rect(0, y + 18, 360, this.height - 18);
                ctx.clip();
                
                const tileW = 48;
                for (let x = this.x; x < 360 + tileW; x += tileW) {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(x, y + 18, tileW, this.height - 18);
                    
                    // Effet de texture
                    for (let i = 0; i < 6; i++) {
                        ctx.fillStyle = 'rgba(0, 0, 0, 0.08)';
                        ctx.beginPath();
                        ctx.arc(
                            x + Math.random() * tileW,
                            y + 28 + Math.random() * (this.height - 38),
                            2 + Math.random() * 3,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                    }
                }
                ctx.restore();
            }
        };

        // Nuages (d√©cor)
        const clouds = {
            list: [],
            
            add: function() {
                if (Math.random() < 0.02 && this.list.length < 5) {
                    this.list.push({
                        x: 360,
                        y: Math.random() * (640 / 3),
                        radius: 20 + Math.random() * 30,
                        speed: 0.5 + Math.random() * difficulty.speed * 0.5
                    });
                }
            },
            
            update: function() {
                this.add();
                
                for (let i = 0; i < this.list.length; i++) {
                    const cloud = this.list[i];
                    cloud.x -= cloud.speed;
                    
                    if (cloud.x + cloud.radius < 0) {
                        this.list.splice(i, 1);
                        i--;
                    }
                }
            },
            
            draw: function() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                for (const cloud of this.list) {
                    // Dessiner plusieurs cercles pour chaque nuage
                    ctx.beginPath();
                    ctx.arc(cloud.x, cloud.y, cloud.radius, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.radius * 0.6, cloud.y - cloud.radius * 0.3, cloud.radius * 0.7, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.radius * 1.3, cloud.y, cloud.radius * 0.8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.closePath();
                }
            },
            
            reset: function() {
                this.list = [];
            }
        };

        // Score
        function drawScore() {
            ctx.fillStyle = '#0b1020';
            ctx.font = '900 40px system-ui';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(score, 180, 80);
            
            // Ombre du texte
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillText(score, 182, 82);
        }

        // Instructions
        function drawInstructions() {
            ctx.fillStyle = '#0b1020';
            ctx.font = '700 26px system-ui';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Clique/Espace pour voler', 180, 140);
            
            ctx.font = '500 18px system-ui';
            ctx.fillText('Passe entre les tuyaux !', 180, 176);
        }

        // D√©tection des collisions
        function checkCollisions() {
            // Collision avec le sol
            if (bird.y + bird.radius > 640 - ground.height) {
                return true;
            }
            
            // Collision avec les tuyaux
            for (const pipe of pipes.list) {
                // Tuyau du haut
                if (
                    bird.x + bird.radius > pipe.x && 
                    bird.x - bird.radius < pipe.x + pipes.width && 
                    bird.y - bird.radius < pipe.topHeight
                ) {
                    return true;
                }
                
                // Tuyau du bas
                if (
                    bird.x + bird.radius > pipe.x && 
                    bird.x - bird.radius < pipe.x + pipes.width && 
                    bird.y + bird.radius > pipe.bottomY
                ) {
                    return true;
                }
            }
            
            return false;
        }

        // V√©rifier si l'oiseau a pass√© un tuyau
        function checkScore() {
            for (const pipe of pipes.list) {
                if (!pipe.passed && bird.x > pipe.x + pipes.width) {
                    pipe.passed = true;
                    score++;
                    
                    // Jouer le son de score
                    try {
                        scoreSound.currentTime = 0;
                        scoreSound.play();
                    } catch(e) {
                        console.log("Erreur de son:", e);
                    }
                    
                    // Mettre √† jour le meilleur score
                    if (score > bestScore) {
                        bestScore = score;
                        localStorage.setItem('birdDashBestScore', bestScore);
                    }
                }
            }
        }

        // Fonction principale du jeu
        function gameLoop(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            accumulator += deltaTime;
            
            // Mettre √† jour la physique √† un taux constant (60fps)
            while (accumulator >= 16.67) {
                if (gameRunning) {
                    bird.update();
                    pipes.update();
                    ground.update();
                    clouds.update();
                    
                    checkScore();
                    
                    if (checkCollisions()) {
                        gameOver();
                        break;
                    }
                }
                accumulator -= 16.67;
            }
            
            // Dessiner
            ctx.clearRect(0, 0, 360, 640);
            
            // Ciel avec d√©grad√©
            const gradient = ctx.createLinearGradient(0, 0, 0, 640);
            gradient.addColorStop(0, '#8ed9ff');
            gradient.addColorStop(0.5, '#a6e4ff');
            gradient.addColorStop(1, '#d7f6ff');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 360, 640);
            
            // Nuages de fond
            clouds.draw();
            
            // Tuyaux
            pipes.draw();
            
            // Sol
            ground.draw();
            
            // Oiseau
            bird.draw();
            
            // Score ou instructions
            if (gameRunning) {
                drawScore();
            } else if (!menuScreen.classList.contains('hidden')) {
                // Menu principal - rien √† faire
            } else if (!gameOverScreen.classList.contains('hidden')) {
                // Game Over - rien √† faire
            } else {
                // Instructions
                drawInstructions();
            }
            
            // Continuer la boucle de jeu
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // D√©marrer le jeu
        function startGame() {
            // R√©initialiser les √©l√©ments du jeu
            bird.reset();
            pipes.reset();
            clouds.reset();
            score = 0;
            
            // Cacher les √©crans de menu/game over
            menuScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            menuBtn.style.display = 'block';
            
            // Afficher les instructions pendant 2 secondes
            instructionsScreen.classList.remove('hidden');
            
            setTimeout(() => {
                instructionsScreen.classList.add('hidden');
                
                // D√©marrer la g√©n√©ration de tuyaux
                clearInterval(pipeIntervalId);
                pipeIntervalId = setInterval(() => pipes.add(), difficulty.pipeInterval);
                
                // D√©marrer la boucle de jeu
                gameRunning = true;
            }, 2000);
        }

        // Retour au menu
        function returnToMenu() {
            gameRunning = false;
            clearInterval(pipeIntervalId);
            menuScreen.classList.remove('hidden');
            gameOverScreen.classList.add('hidden');
            instructionsScreen.classList.add('hidden');
            menuBtn.style.display = 'none';
        }

        // Game Over
        function gameOver() {
            gameRunning = false;
            clearInterval(pipeIntervalId);
            menuBtn.style.display = 'none';
            
            // Jouer le son de collision
            try {
                hitSound.currentTime = 0;
                hitSound.play();
            } catch(e) {
                console.log("Erreur de son:", e);
            }
            
            // Afficher l'√©cran de game over
            finalScoreElement.textContent = score;
            bestScoreElement.textContent = bestScore;
            gameOverScreen.classList.remove('hidden');
            
            // Feedback visuel
            canvas.style.transform = 'scale(0.98)';
            setTimeout(() => {
                canvas.style.transform = 'scale(1)';
            }, 100);
        }

        // √âcouteurs d'√©v√©nements
        function handleJump() {
            if (isClicking) return;
            
            isClicking = true;
            setTimeout(() => { isClicking = false; }, 100);
            
            if (!gameRunning && !gameOverScreen.classList.contains('hidden')) {
                startGame();
            } else if (gameRunning) {
                bird.jump();
                
                // Feedback visuel
                canvas.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    canvas.style.transform = 'scale(1)';
                }, 100);
            }
        }

        // Clavier
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.key === ' ' || e.key === 'ArrowUp') {
                handleJump();
                e.preventDefault();
            }
        });

        // Mobile (tactile)
        canvas.addEventListener('touchstart', (e) => {
            handleJump();
            e.preventDefault();
        }, { passive: false });

        canvas.addEventListener('click', handleJump);

        // Bouton de red√©marrage
        restartBtn.addEventListener('click', startGame);

        // Bouton retour au menu
        backToMenuBtn.addEventListener('click', returnToMenu);
        menuBtn.addEventListener('click', returnToMenu);

        // S√©lection de la difficult√©
        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                difficulty = config.difficulties[button.dataset.difficulty];
                startGame();
            });
        });

        // D√©marrer la boucle de jeu
        animationFrameId = requestAnimationFrame(gameLoop);
    </script>
</body>
</html>