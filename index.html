<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flappy ‚Äî Clone HTML</title>
  <style>
    :root{
      --ink:#0b1020; --ui:#10192f; --panel:#0e1731; --stroke:#21336b; --brand:#3bd6ff;
      --text:#e8f1ff; --sub:#b6c7ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#7fd2ff 0%,#87ddff 40%,#b9f2ff 100%);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text)}

    .wrap{min-height:100%;display:flex;flex-direction:column}
    header{position:sticky;top:0;z-index:5;background:rgba(14,23,49,.65);backdrop-filter:blur(6px);border-bottom:1px solid #21336b}
    .toolbar{max-width:960px;margin:0 auto;padding:10px 12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .title{font-weight:800;letter-spacing:.5px}
    .btn, select, label.sw{background:#0f1734;border:1px solid #22306e;color:#eaf1ff;border-radius:12px;padding:8px 12px;font-size:14px}
    .btn{cursor:pointer}
    .btn:hover{border-color:#2e43a6}
    .stat{background:#0f1734;border:1px solid #22306e;border-radius:12px;padding:6px 10px;font-weight:700}
    .grow{flex:1}

    main{flex:1;display:grid;place-items:center;padding:16px}
    canvas{background:linear-gradient(180deg,#8ed9ff 0%,#a6e4ff 45%,#d7f6ff 100%);border-radius:22px;box-shadow:0 20px 60px rgba(0,0,0,.30), inset 0 0 0 2px #bfe9ff}

    footer{padding:10px;color:#0c2257;text-align:center;font-size:12px}
    .hint{color:#0c2257}

    @media (max-width:780px){ canvas{width:92vw;height:138vw;max-width:420px;max-height:630px} }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="toolbar">
      <span class="title">üê§ Flappy ‚Äî Clone</span>
      <button class="btn" id="playBtn">Jouer</button>
      <button class="btn" id="pauseBtn">Pause</button>
      <label class="sw"><input id="soundSw" type="checkbox" checked> son</label>
      <label class="sw">Difficult√©
        <select id="diff">
          <option value="easy">Facile</option>
          <option value="normal" selected>Normal</option>
          <option value="hard">Difficile</option>
        </select>
      </label>
      <span class="grow"></span>
      <span class="stat">Score: <span id="score">0</span></span>
      <span class="stat">Record: <span id="best">0</span></span>
    </div>
  </header>

  <main>
    <canvas id="game" width="432" height="648" aria-label="Jeu Flappy"></canvas>
  </main>
  <footer>
    <span class="hint">Espace / Clic / Touch = voler ‚Ä¢ P = pause ‚Ä¢ R = rejouer</span>
  </footer>
</div>

<script>
(function(){
  // Canvas & DPR
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const DPR = Math.max(1, Math.floor(window.devicePixelRatio||1));
  function fit(){
    const targetW = 432, targetH = 648; // ratio 2:3 environ
    const S = Math.min(Math.min(window.innerWidth-40, 520), Math.min(window.innerHeight-160, 740));
    const h = Math.floor(S*1.5); const w = Math.floor(S);
    cvs.style.width = w+'px'; cvs.style.height = h+'px';
    cvs.width = w*DPR; cvs.height = h*DPR; ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  fit(); window.addEventListener('resize', fit);

  // UI elts
  const playBtn = document.getElementById('playBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const soundSw = document.getElementById('soundSw');
  const diffSel = document.getElementById('diff');
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');

  // Storage
  const store = {
    get best(){ return parseInt(localStorage.getItem('flappy.best')||'0',10) },
    set best(v){ localStorage.setItem('flappy.best', String(v)) }
  };
  bestEl.textContent = store.best;

  // Simple audio (no assets)
  let audioCtx=null;
  function beep(freq=600, dur=.06, type='square', vol=.03){
    if(!soundSw.checked) return; if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const t=audioCtx.currentTime; const o=audioCtx.createOscillator(); const g=audioCtx.createGain();
    o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination);
    o.start(t); o.stop(t+dur);
  }

  // Game constants (tuned to feel like the original)
  const G = 0.25;           // gravity (px/frame^2 @ ~60fps)
  const JUMP_V = -4.6;      // jump impulse
  const PIPE_SPEED = 2.0;   // px/frame
  const GROUND_H = 100;     // ground height in px
  const PIPE_W = 64;        // pipe width
  const GAP_NORMAL = 120;   // vertical gap
  const GAP_EASY = 140;
  const GAP_HARD = 100;
  const PIPE_SPACING = 200; // distance between pipe pairs

  // State
  let bird, pipes, groundX, score, state, lastT=0, acc=0, running=false, gap=GAP_NORMAL;
  const STATE = { READY:0, PLAY:1, GAMEOVER:2 };

  function newBird(){
    return { x: cvs.width/3, y: cvs.height/2, v:0, r:0, rTarget:0 };
  }
  function newPipes(){
    const arr=[]; const count = Math.ceil(cvs.width / PIPE_SPACING) + 2;
    let x = cvs.width + 80; // start off screen
    for(let i=0;i<count;i++){ arr.push(makePair(x)); x += PIPE_SPACING; }
    return arr;
  }
  function makePair(x){
    const h = cvs.height - GROUND_H; // playable height
    const g = gap;
    const center = Math.floor( h*0.25 + Math.random()*h*0.5 );
    const topH = Math.max(40, center - Math.floor(g/2));
    const bottomY = center + Math.floor(g/2);
    return { x, topH, bottomY, passed:false };
  }

  function reset(){
    switch(diffSel.value){
      case 'easy': gap = GAP_EASY; break;
      case 'hard': gap = GAP_HARD; break;
      default: gap = GAP_NORMAL; break;
    }
    bird = newBird();
    pipes = newPipes();
    groundX = 0; score = 0; scoreEl.textContent = score; state = STATE.READY; running=true; acc=0; lastT=0;
  }

  function flap(){
    if(state===STATE.GAMEOVER){ reset(); state=STATE.PLAY; return; }
    if(state===STATE.READY){ state=STATE.PLAY; }
    bird.v = JUMP_V; bird.rTarget = -0.5; // tilt up
    beep(720,.07,'square',.03);
  }

  // Input
  playBtn.onclick = ()=>{ if(state!==STATE.PLAY) flap(); };
  pauseBtn.onclick = ()=>{ running=!running; if(running){ lastT=0; requestAnimationFrame(loop);} };
  cvs.addEventListener('mousedown', flap);
  cvs.addEventListener('touchstart', (e)=>{ e.preventDefault(); flap(); }, {passive:false});
  window.addEventListener('keydown', (e)=>{
    if(e.code==='Space') { e.preventDefault(); flap(); }
    if(e.key==='p' || e.key==='P'){ running=!running; if(running){ lastT=0; requestAnimationFrame(loop);} }
    if(e.key==='r' || e.key==='R'){ reset(); }
  });

  function update(){
    // physics
    if(state===STATE.PLAY){
      bird.v += G; bird.v = Math.min(bird.v, 10);
      bird.y += bird.v;
      bird.rTarget = bird.v>0? Math.min(1.0, bird.v/8) : -0.5;
    }
    // smooth rotation
    bird.r += (bird.rTarget - bird.r) * 0.2;

    // pipes & score
    if(state===STATE.PLAY){
      for(const p of pipes){ p.x -= PIPE_SPEED; }
      // recycle pipes
      if(pipes[0].x + PIPE_W < -40){ pipes.shift(); const lastX = pipes[pipes.length-1].x; pipes.push(makePair(lastX + PIPE_SPACING)); }
      // scoring
      for(const p of pipes){ if(!p.passed && p.x + PIPE_W < bird.x){ p.passed=true; score++; scoreEl.textContent=score; beep(860,.05,'triangle',.025); if(score>store.best){ store.best=score; bestEl.textContent=store.best; } } }
    }

    // ground scroll
    groundX = (groundX - PIPE_SPEED) % 48;

    // collisions
    if(state===STATE.PLAY){
      // ground / ceiling
      if(bird.y + 12 >= cvs.height - GROUND_H || bird.y - 12 <= 0){
        return gameOver();
      }
      // pipes collision (circle vs rect)
      const r = 12; // bird radius
      for(const p of pipes){
        const topRect = {x:p.x, y:0, w:PIPE_W, h:p.topH};
        const botRect = {x:p.x, y:p.bottomY, w:PIPE_W, h:(cvs.height-GROUND_H-p.bottomY)};
        if(circleRect(bird.x, bird.y, r, topRect) || circleRect(bird.x,bird.y,r,botRect)){
          return gameOver();
        }
      }
    }
  }

  function circleRect(cx,cy,r,rect){
    const nx = Math.max(rect.x, Math.min(cx, rect.x+rect.w));
    const ny = Math.max(rect.y, Math.min(cy, rect.y+rect.h));
    const dx = cx - nx, dy = cy - ny; return (dx*dx + dy*dy) <= r*r;
  }

  function drawBackground(){
    const w=cvs.width/DPR, h=cvs.height/DPR;
    // sky gradient already via CSS, but fill to clear
    ctx.fillStyle = ctx.createLinearGradient(0,0,0,h);
    ctx.fillStyle.addColorStop?.(0,'#8ed9ff'); ctx.fillStyle.addColorStop?.(0.5,'#a6e4ff'); ctx.fillStyle.addColorStop?.(1,'#d7f6ff');
    ctx.fillRect(0,0,w,h);

    // clouds
    function cloud(x,y,s){
      ctx.save(); ctx.translate(x,y); ctx.scale(s,s);
      ctx.fillStyle='rgba(255,255,255,.9)';
      blob(0,0,22); blob(18,4,18); blob(-18,6,16); blob(6,-6,16);
      ctx.restore();
    }
    cloud(60,80,1.2); cloud(240,60,1.0); cloud(340,120,.9);
  }

  function blob(x,y,r){ ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }

  function drawPipes(){
    for(const p of pipes){ drawPipePair(p); }
  }
  function drawPipePair(p){
    const w = PIPE_W, lip=10;
    // style similar: green tubes with caps
    // top pipe
    ctx.fillStyle = '#43d96b';
    ctx.fillRect(p.x, 0, w, p.topH);
    ctx.fillStyle = '#31c45a';
    ctx.fillRect(p.x-2, p.topH-lip, w+4, lip);
    // bottom pipe
    const bh = (cvs.height-GROUND_H) - p.bottomY;
    ctx.fillStyle = '#43d96b';
    ctx.fillRect(p.x, p.bottomY, w, bh);
    ctx.fillStyle = '#31c45a';
    ctx.fillRect(p.x-2, p.bottomY, w+4, lip);

    // shiny stripe
    ctx.fillStyle = 'rgba(255,255,255,.25)';
    ctx.fillRect(p.x+6, (p.topH>40?6:0), 6, Math.max(0,p.topH-12));
    ctx.fillRect(p.x+6, p.bottomY+6, 6, Math.max(0,bh-12));
  }

  function drawGround(){
    const w=cvs.width/DPR, h=cvs.height/DPR;
    const y = h - GROUND_H;
    // grassy top
    const g=ctx.createLinearGradient(0,y-12,0,y+8);
    g.addColorStop(0,'#7be66a'); g.addColorStop(1,'#3ab54a');
    ctx.fillStyle=g; ctx.fillRect(0,y,w,18);

    // dirt with repeating pattern
    ctx.save();
    ctx.beginPath(); ctx.rect(0,y+18,w,GROUND_H-18); ctx.clip();
    const tileW=48; // repeat
    for(let x=groundX; x<w+tileW; x+=tileW){
      ctx.fillStyle='#caa46a'; ctx.fillRect(x,y+18, tileW,GROUND_H-18);
      for(let i=0;i<6;i++){
        ctx.fillStyle='rgba(0,0,0,.08)'; ctx.beginPath(); ctx.arc(x+Math.random()*tileW, y+28+Math.random()*(GROUND_H-38), 2+Math.random()*3, 0,Math.PI*2); ctx.fill();
      }
    }
    ctx.restore();
  }

  function drawBird(){
    ctx.save();
    ctx.translate(bird.x, bird.y); ctx.rotate(bird.r);
    const r=12;
    // body
    const grad = ctx.createRadialGradient(-4,-6,6, 0,0,18);
    grad.addColorStop(0,'#ffe985'); grad.addColorStop(0.7,'#ffcc45'); grad.addColorStop(1,'#ffb020');
    ctx.fillStyle=grad; ctx.beginPath(); ctx.ellipse(0,0, r*1.1, r*0.95, 0, 0, Math.PI*2); ctx.fill();
    // wing (flap slightly)
    const wingY = Math.sin(perfNow()*0.02)*2;
    ctx.fillStyle='#fff6cf'; ctx.beginPath(); ctx.ellipse(-2, wingY, r*0.7, r*0.45, -0.5, 0, Math.PI*2); ctx.fill();
    // eye
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(5,-4, r*0.28, 0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(5+2,-4+1, r*0.12, 0,Math.PI*2); ctx.fill();
    // beak
    ctx.fillStyle='#ff7b18'; ctx.beginPath(); ctx.moveTo(r*0.9,0); ctx.lineTo(r*1.5,4); ctx.lineTo(r*0.9,6); ctx.closePath(); ctx.fill();
    ctx.restore();
  }

  function drawHUD(){
    const w=cvs.width/DPR;
    if(state===STATE.READY){
      textC('Clique/Espace pour voler', w/2, 140, '700 26px system-ui');
      textC('Passe entre les tuyaux !', w/2, 176, '500 18px system-ui');
    }
    if(state===STATE.GAMEOVER){
      textC('Game Over', w/2, 160, '800 32px system-ui');
      textC('R pour rejouer', w/2, 196, '600 18px system-ui');
      // medals
      const medal = score>=30? 'ü•á' : score>=20? 'ü•à' : score>=10? 'ü•â' : ' '; if(medal!==' '){ textC(medal, w/2, 230, '40px system-ui'); }
    }
    // live score
    if(state===STATE.PLAY){ textC(String(score), w/2, 80, '900 40px system-ui', '#ffffff', '#00000033'); }
  }

  function textC(t,x,y,font,fill='#0b1020',shadow=null){
    ctx.save(); ctx.font=font; ctx.textAlign='center'; ctx.textBaseline='middle';
    if(shadow){ ctx.fillStyle=shadow; ctx.fillText(t,x+2,y+2); }
    ctx.fillStyle=fill; ctx.fillText(t,x,y); ctx.restore();
  }

  function gameOver(){
    state=STATE.GAMEOVER; beep(240,.18,'sawtooth',.05);
  }

  function draw(){
    drawBackground();
    drawPipes();
    drawGround();
    drawBird();
    drawHUD();
  }

  function perfNow(){ return (performance?.now?.()||Date.now()); }

  function loop(ts){
    if(!running){ draw(); return; }
    if(!lastT) lastT=ts; const dt = ts-lastT; lastT=ts; acc += dt;
    while(acc >= 16){ update(); acc -= 16; }
    draw();
    requestAnimationFrame(loop);
  }

  // start
  reset();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
